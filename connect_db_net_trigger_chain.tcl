set hist_out_ports [get_bd_pins hls_histogrammer_0/barrel_bins_*_*_V]
set histbuf_in_ports [get_bd_pins hls_histogram_buffer_0/inBarrelBins_*_*_V]
connect_bd_net [get_bd_pins hls_histogrammer_0/outReset] [get_bd_pins hls_histogram_buffer_0/inReset]

for {set x 0} {$x < [llength $hist_out_ports]} {incr x} {
  connect_bd_net [get_bd_pins [lindex $hist_out_ports $x]] [get_bd_pins [lindex $histbuf_in_ports $x]]
}


set histbuf_out_ports [get_bd_pins hls_histogram_buffer_0/outBins_*_V]
set jetclust_in_ports [get_bd_pins hls_jet_clustering_0/inCaloGridPhiSlice_*_V]
connect_bd_net [get_bd_pins hls_histogram_buffer_0/outReset] [get_bd_pins hls_jet_clustering_0/reset]

for {set x 0} {$x < [llength $histbuf_out_ports]} {incr x} {
  connect_bd_net [get_bd_pins [lindex $histbuf_out_ports $x]] [get_bd_pins [lindex $jetclust_in_ports $x]]
}

# add clock source
apply_bd_automation -rule xilinx.com:bd_rule:clkrst -config {Clk "New External Port (240 MHz)" }  [get_bd_pins hls_histogrammer_0/ap_clk]
connect_bd_net [get_bd_ports clk_240MHz] [get_bd_pins hls_histogram_buffer_0/ap_clk]
connect_bd_net [get_bd_ports clk_240MHz] [get_bd_pins hls_jet_clustering_0/ap_clk]

create_bd_port -dir I -type clk in_clock_240MHz
set_property CONFIG.FREQ_HZ 240000000 [get_bd_ports in_clock_240MHz]
connect_bd_net [get_bd_ports in_clock_240MHz] [get_bd_pins hls_histogrammer_0/ap_clk]
connect_bd_net [get_bd_ports in_clock_240MHz] [get_bd_pins hls_histogram_buffer_0/ap_clk]
connect_bd_net [get_bd_ports in_clock_240MHz] [get_bd_pins hls_jet_clustering_0/ap_clk]

#delete_bd_objs [get_bd_nets hls_histogram_buffer_0_outBins_0_V] [get_bd_nets hls_histogram_buffer_0_outBins_1_V] [get_bd_nets hls_histogram_buffer_0_outBins_2_V] [get_bd_nets hls_histogram_buffer_0_outBins_3_V] [get_bd_nets hls_histogram_buffer_0_outBins_4_V] [get_bd_nets hls_histogram_buffer_0_outBins_5_V] [get_bd_nets hls_histogram_buffer_0_outBins_6_V] [get_bd_nets hls_histogram_buffer_0_outBins_7_V] [get_bd_nets hls_histogram_buffer_0_outBins_8_V] [get_bd_nets hls_histogram_buffer_0_outBins_9_V] [get_bd_nets hls_histogram_buffer_0_outBins_10_V] [get_bd_nets hls_histogram_buffer_0_outBins_11_V] [get_bd_nets hls_histogram_buffer_0_outBins_12_V] [get_bd_nets hls_histogram_buffer_0_outBins_13_V] [get_bd_nets hls_histogram_buffer_0_outBins_14_V] [get_bd_nets hls_histogram_buffer_0_outBins_15_V] [get_bd_nets hls_histogram_buffer_0_outBins_16_V] [get_bd_nets hls_histogram_buffer_0_outBins_17_V] [get_bd_nets hls_histogram_buffer_0_outReset]
#delete_bd_objs [get_bd_nets hls_histogrammer_0_barrel_bins_0_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_0_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_1_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_2_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_3_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_4_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_5_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_6_8_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_0_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_1_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_2_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_3_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_4_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_5_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_6_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_7_V] [get_bd_nets hls_histogrammer_0_barrel_bins_7_8_V] [get_bd_nets hls_histogrammer_0_outReset]